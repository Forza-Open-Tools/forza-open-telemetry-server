import fs from 'fs';
import Collector from './Collector';
import Parser from './Parser';

const parser = new Parser('ForzaHorizon5');
const outfile = fs.openSync('telemetrycapture.json', 'w+');
const server = new Collector(11000, (buf, rinfo) => {
  console.log('Received message', buf.length, 'bytes long, rinfo.size=', rinfo.size);
  const data = parser.toArray(buf);
  fs.writeSync(outfile, JSON.stringify(data));
  fs.writeSync(outfile, '\n');
  console.log(JSON.stringify(data));
  // const row = parser.toTelemetryRow(buf);
  // console.log(JSON.stringify(row));
});

server.start();
const sampleRow = [
  true,
  2738468,
  7999.9951171875,
  899.9994506835938,
  4133.52685546875,
  -0.08792376518249512,
  -0.10056853294372559,
  7.26175594329834,
  0.0009188652038574219,
  -0.1193869337439537,
  9.496946334838867,
  0.0011331600835546851,
  0.006413040682673454,
  -0.0007179949898272753,
  -0.4774966239929199,
  -0.016649942845106125,
  0.003462767694145441,
  0.275574266910553,
  0.2783244550228119,
  0.5880635976791382,
  0.5863686800003052,
  0.18135905265808105,
  0.17415472865104675,
  0.29745620489120483,
  0.3004131019115448,
  30.320531845092773,
  30.25856590270996,
  30.94446563720703,
  30.928361892700195,
  0,
  0,
  0,
  0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   -0.007857287302613258,
//   -0.007691855542361736,
//   0.004508378449827433,
//   0.007255214732140303,
//   0.1815291792154312,
//   0.17432451248168945,
//   0.29749035835266113,
//   0.30050069093704224,
//   -0.019059032201766968,
//   -0.018660038709640503,
//   0.022199735045433044,
//   0.021932125091552734,
//   148,
//   2,
//   188,
//   2,
//   4,
//   23,
//   -1113.8603515625,
//   204.8640899658203,
//   -3817.495849609375,
//   9.497695922851562,
//   141165.671875,
//   326.8154296875,
//   115.74676513671875,
//   115.7098617553711,
//   117.25871276855469,
//   117.25871276855469,
//   17.639957427978516,
//   1,
//   -157.73727416992188,
//   0,
//   0,
//   1.5348683595657349,
//   1.534867763519287,
//   0,
//   8,
//   246,
//   0,
//   0,
//   0,
//   1,
//   0,
//   68,
//   0
// ];
